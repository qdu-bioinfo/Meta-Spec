# **Source Codes for Meta-Spec**

## Contents

- [Introduction](#introduction)
- [Package requirement](#package-requirement)
- [Input format](#input-and-output-format)
- [Run example](#run-example)
- [Citation](#citation)
- [Contact](#contact)

## Introduction

Meta-Spec is a microbiome multi-label disease classification model based on explainable deep learning which is capable to detect multiple diseases simultaneously by integrating genotype data (microbiome features) and phenotype data (host variables).

## Package requirement

- torch==1.9.0+cu111
- deepctr-torch==0.2.7
- shap==0.35.0

```
sh init.sh
```

## Input  format
To train Meta-Spec, two files are required as input including microbes data and diseases labels. Besides, you can also set host variables data as input.
Microbes data:
| **SampleID** | **asv1**  | **asv2**|
| ---------- | --------- | --------- |
| 1             | 0.1        |0.002      |
| 2             | 0.05      |0.01      |
| 3             | 0.07      |0.03      |
Label data:
| **SampleID** | **ibs**  | **thyroid**|
| ---------- | --------- | --------- |
| 1             | 0        |1      |
| 2             | 0      |0      |
| 3             | 1      |1      |
Host variables data:
| **SampleID** | **age**  | **bmi**|
| ---------- | --------- | --------- |
| 1             | 5        |2      |
| 2             | 2      |1      |
| 3             | 7      |3      |

## Run example

To run Meta-Spec, you need to run meta_spec_train.py to obtain a model file. Set microbes data path and diseases label path by '--microbe' and '--label'. If you need add host variables, please set its path by '--host'. In addition, you can sepecify the path of outputs and the name of model file by setting '--o' and '--m' respectively.
```
cd inference/
python meta_spec_train.py --microbe '../data/train_microbe_data.csv' --host '../data/train_hosts_data.csv' --label '../data/train_labels.csv' --o 'res/' --m 'meta_spec.model'
```
Then, you can predict your test files using the model file generated by the training command. Please set '--disease_name' to specify the target diseases.
```
python meta_spec_test.py --microbe '../data/test_microbe_data.csv' --host '../data/test_hosts_data.csv' --o 'res/' --m 'meta_spec.model' --disease_name 'ibs thyroid migraine autoimmune lung_disease'
```
Similar to meta_spec_train.py, before geting the MSI results, you need to train a model by running meta_spec_imp.py. After that, you can obtain MSI values by running get_msi.py. If the '--is_plot' is set to be True, bar charts for each disease will be generated.
```
python meta_spec_imp.py --microbe '../data/train_microbe_data.csv' --host '../data/train_hosts_data.csv' --label '../data/train_labels.csv' --o 'res/' --m 'msi.model'

python get_msi.py --microbe '../data/test_microbe_data.csv' --host '../data/test_hosts_data.csv' --o 'res/' --m 'msi.model' --disease_name 'ibs thyroid migraine autoimmune lung_disease' --is_plot True --max_plot 30
```

For convenience, you can run the processes above by running the example.sh in folder 'inference/'.
```
cd inference
chmod a+x example.sh
./example.sh
```

## Citation


## Contact
All problems please contact Meta-Spec development team: 
**Xiaoquan Su**&nbsp;&nbsp;&nbsp;&nbsp;Email: suxq@qdu.edu.cn
